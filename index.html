<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<title>Interactive Bubble Chart</title>
<style>
  body {margin:0; background:#0b1020; color:white; font-family:sans-serif;}
  #chart-wrap {position:relative; height:640px;}
  svg {width:100%; height:100%;}
  .tooltip {position:absolute; display:none; background:#101a37; color:white;
    border:1px solid #2d3a69; border-radius:8px; padding:8px 10px; font-size:13px;
    box-shadow:0 6px 12px rgba(0,0,0,0.4);}
  .legend {position:absolute; right:10px; bottom:10px; font-size:13px;}
  .legend .dot {width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px;}
  .label {pointer-events:none; fill:white; font-weight:700; text-anchor:middle;
    paint-order:stroke; stroke:rgba(0,0,0,0.55); stroke-width:2px;}
</style>
</head>
<body>
<div id="chart-wrap">
  <div id="tooltip" class="tooltip"></div>
  <div id="legend" class="legend"></div>
  <svg id="chart"></svg>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>
<script>
  const data = [{"name": "Type 2 diabetes", "value": 80, "group": "Primary Care", "links": [{"text": "Mechanisms linking obesity to insulin resistance and type 2 diabetes", "url": "https://pubmed.ncbi.nlm.nih.gov/17167471/"}, {"text": "Obesity-related glomerulopathy: an emerging epidemic", "url": "https://pubmed.ncbi.nlm.nih.gov/11260414/"}]}, {"name": "Urinary Incontinence", "value": 80, "group": "Primary Care", "links": [{"text": "Obesity and female stress urinary incontinence", "url": "https://pubmed.ncbi.nlm.nih.gov/23972338/"}, {"text": "Obesity and stress urinary incontinence in women", "url": "https://pubmed.ncbi.nlm.nih.gov/28150033/"}]}, {"name": "Albuminuria/Proteinuria", "value": 60, "group": "Primary Care", "links": [{"text": "Obesity-related glomerulopathy: an emerging epidemic", "url": "https://pubmed.ncbi.nlm.nih.gov/11260414/"}]}, {"name": "Gestational Hypertension", "value": 60, "group": "OB-GYN", "links": [{"text": "Increased risk for the development of preeclampsia in obese pregnancies", "url": "https://pubmed.ncbi.nlm.nih.gov/26447211/"}]}, {"name": "CKD", "value": 70, "group": "Primary Care", "links": [{"text": "Impact of body mass index on adverse kidney events in diabetes mellitus patients: A systematic-review and meta-analysis", "url": "https://pubmed.ncbi.nlm.nih.gov/38322463/"}]}, {"name": "Periodontitis", "value": 60, "group": "Other", "links": [{"text": "Obesity and periodontal disease", "url": "https://pubmed.ncbi.nlm.nih.gov/21691545/"}]}, {"name": "HTN", "value": 70, "group": "Cardiology", "links": [{"text": "ACC/AHA Guideline", "url": "https://www.ahajournals.org/doi/10.1161/HYP.0000000000000065"}]}, {"name": "OSA", "value": 36, "group": "Primary Care", "links": [{"text": "OSA & obesity", "url": "https://pubmed.ncbi.nlm.nih.gov/18250211/"}]}, {"name": "NAFLD/MASLD", "value": 50, "group": "Endocrinology", "links": [{"text": "NAFLD overview", "url": "https://pubmed.ncbi.nlm.nih.gov/33989548/"}]}, {"name": "Depression", "value": 28, "group": "Other", "links": [{"text": "Depression & obesity", "url": "https://pubmed.ncbi.nlm.nih.gov/29453413/"}]}];
  const colors = {"Cardiology": "#D8907D", "Endocrinology": "#F9AC8D", "OB-GYN": "#FEC671", "Primary Care": "#6277BA", "Other": "#C7D8EF"};
  const svg = d3.select("#chart");
  const wrap = document.getElementById("chart-wrap");
  const tooltip = document.getElementById("tooltip");
  const legendDiv = document.getElementById("legend");

  const W = wrap.clientWidth || 960, H = wrap.clientHeight || 640;
  svg.attr("viewBox",[0,0,W,H]).attr("preserveAspectRatio","xMidYMid meet");

  // Legend
  legendDiv.innerHTML = Object.entries(colors)
    .map(([k,v]) => `<span class="dot" style="background:${v}"></span>${k}`)
    .join("&nbsp;&nbsp;");

  // Bubble size
  const minR = Math.min(W,H)/14, maxR = Math.min(W,H)/5.5;
  const size = d3.scaleSqrt()
    .domain([d3.min(data,d=>d.value), d3.max(data,d=>d.value)])
    .range([minR, maxR]);

  // Layout with collision + boundary clamp
  const PADDING = 8;
  const nodes = data.map(d => ({...d, x:Math.random()*W, y:Math.random()*H, r:size(d.value)}));
  const sim = d3.forceSimulation(nodes)
    .force("center", d3.forceCenter(W/2,H/2))
    .force("charge", d3.forceManyBody().strength(2))
    .force("collision", d3.forceCollide().radius(d => d.r+4))
    .stop();
  for (let i=0;i<300;i++){
    sim.tick();
    for (const d of nodes){
      d.x = Math.max(d.r+PADDING, Math.min(W-d.r-PADDING, d.x));
      d.y = Math.max(d.r+PADDING, Math.min(H-d.r-PADDING, d.y));
    }
  }

  // Draw
  const g = svg.append("g");
  const bubble = g.selectAll("g").data(nodes).enter().append("g")
    .attr("transform", d => `translate(${d.x},${d.y})`);

  bubble.append("circle")
    .attr("r", d=>d.r)
    .attr("fill", d=>colors[d.group] || "#999")
    .attr("stroke","rgba(0,0,0,0.65)").attr("stroke-width",1.5)
    .on("mousemove",(event,d)=>{
      tooltip.style.display="block";
      tooltip.style.left=(event.clientX+12)+"px";
      tooltip.style.top=(event.clientY+12)+"px";
      tooltip.innerHTML=`<strong>${d.name}</strong><ul>`+
        (d.links||[]).map(l=>`<li><a href="${l.url}" target="_blank" rel="noopener">${l.text}</a></li>`).join("")+
        `</ul>`;
    })
    .on("mouseleave",()=>tooltip.style.display="none")
    .on("click",(event,d)=>{ if(d.links && d.links[0]) window.open(d.links[0].url,"_blank","noopener"); });

  bubble.append("text")
    .attr("class","label")
    .text(d=>d.name)
    .attr("font-size", d=>Math.max(10, d.r/3));
</script>
</body>
</html>
